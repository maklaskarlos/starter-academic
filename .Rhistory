datos2 <- datos1 %>%
# group by year and summarizing sales
group_by(month) %>%
summarize(sales = sum(price_base_EUR)) %>%
ungroup()
datos2$sales <- format(round(as.numeric(datos2$sales), 1), nsmall=1, big.mark=",")
head(datos2)%>%
knitr::kable()%>%
kable_styling(bootstrap_options = "striped", font_size = 14)
library(readr)
datos <- read_csv("C:/Users/karlo/OneDrive/Escritorio/Practicas_Karlos/Proyecto CABIFY/prueba_seleccion.csv") %>%
select(c("journey_id","created_at","currency","price_base","cost_base","region_id"))
datos$ciudad<-"xxx"
datos$ciudad[datos$region_id=="ar_buenos_aires"] = "Buenos Aires"
datos$ciudad[datos$region_id=="barcelona"] = "Barcelona"
datos$ciudad[datos$region_id=="br_rio_de_janeiro"] = "Rio de Janeirol"
datos$ciudad[datos$region_id=="br_sao_paulo"] = "Sao Paulo"
datos$ciudad[datos$region_id=="ec_quito"] = "Quito"
datos$ciudad[datos$region_id=="es_sevilla"] = "Sevilla"
datos$ciudad[datos$region_id=="lima"] = "Lima"
datos$ciudad[datos$region_id=="madrid"] = "Madrid"
datos$ciudad[datos$region_id=="malaga"] = "Malaga"
datos$ciudad[datos$region_id=="mexico"] = "Mexico DF"
datos$ciudad[datos$region_id=="monterrey"] = "Monterrey"
datos$ciudad[datos$region_id=="mx_guadalajara"] = "Guadalajara"
datos$ciudad[datos$region_id=="pt_lisboa"] = "Lisboa"
datos$ciudad[datos$region_id=="puebla"] = "Puebla"
datos$ciudad[datos$region_id=="santiago"] = "Santiago de Chile"
datos$ciudad[datos$region_id=="es_valencia"] = "Valencia"
#summary(datos$ciudad)
datos$ciudad<-as.factor(datos$ciudad)
#summary(datos$ciudad)
datos <- datos %>%
select(c("journey_id","created_at","currency","price_base","cost_base","ciudad"))
datos$month <- months(datos$created_at)
datos$price_base[is.na(datos$price_base)] <- 0
datos0 <- datos %>%
# grouping by year and summarizing sales
group_by(month) %>%
summarize(sales = sum(price_base)) %>%
ungroup()
datos1 <- datos1[c(5,4,8,1,9,7,6,2,12,11,10,3),]
datos$month <- months(datos$created_at)
datos$price_base[is.na(datos$price_base)] <- 0
datos0 <- datos %>%
# grouping by year and summarizing sales
group_by(month) %>%
summarize(sales = sum(price_base)) %>%
ungroup()
datos0 <- datos0[c(5,4,8,1,9,7,6,2,12,11,10,3),]
datos0$sales <- format(round(as.numeric(datos0$sales), 1), nsmall=1, big.mark=",")
head(datos0)%>%
knitr::kable()%>%
kable_styling(bootstrap_options = "striped", font_size = 14)
currDF  <- data.frame(
date = seq.Date(from = as.Date('2017-01-03 13:20:24'), to = as.Date('2017-12-30 09:54:08'), length = 52645),
variable = datos$currency,
amount = datos$price_base,stringsAsFactors=FALSE)
currDF = currDF %>% mutate(aniomes = paste(year(date),month(date)))
currDF$divisaaniomes<-paste(currDF$variable,currDF$aniomes)
#tipos de cambio historicos de 2017
startDt = as.Date("2017-01-03 13:20:24")
endDt = as.Date("2017-12-30 09:54:08")
currCombinations = paste(setdiff(unique(currDF$variable),"EUR"),"EUR=X",sep="")
fxData = do.call(merge.xts,lapply(currCombinations,function(x)
getSymbols.yahoo(x, src="yahoo", from=startDt,to=endDt,auto.assign=FALSE)[,4])) #make sure you have internet
colnames(fxData) = gsub("EUR.X.Close","",colnames(fxData))
fxData$EUR = 1
fxData_DF = data.frame(date=index(fxData),coredata(fxData),stringsAsFactors=FALSE)
fxMolten = melt(fxData_DF,id="date",variable.name="currency",value.name="conversionFactor")
#creamos la columna aniomes para poder calcular el tipo de cambio medio de cada mes
fxMolten = fxMolten %>% mutate(aniomes = paste(year(date),month(date)))
fxMolten %>% group_by(aniomes, variable) %>% summarise(amountmedia = mean(value))
#eliminamos NAs
fxMolten<-fxMolten[complete.cases(fxMolten), ] #desaparecen algunas lineas
fxMolten %>% group_by(aniomes, variable) %>% summarise(amountmedia = mean(value))
#creamos la columna divisaaniomes para poder calcular el tipo de cambio medio de cada mes
fxMolten$divisaaniomes<-paste(fxMolten$variable,fxMolten$aniomes)
tipocamiomedio= fxMolten %>% group_by(divisaaniomes, variable) %>% summarise(amountmedia = mean(value))
#mergeamos con datoscabify
datos = datos %>% mutate(aniomes = paste(year(created_at),month(created_at)))
datos$divisaaniomes<-paste(datos$currency,datos$aniomes)
datosdivisa = merge(datos,tipocamiomedio, by= "divisaaniomes")
#hacemos la conversion de nuestras variables economicas
datosdivisa$price_base_EUR<-datosdivisa$price_base*datosdivisa$amountmedia
datosdivisa$cost_base_EUR<-datosdivisa$cost_base*datosdivisa$amountmedia
datos1 <- inner_join(datos,datosdivisa, by= "journey_id")
datos1 = datos1[,c("journey_id","created_at.x","currency.x","price_base.x","cost_base.x","price_base_EUR","cost_base_EUR","ciudad.x")]
#visualizo nuestra nueva tabla
head(datos1)%>%
knitr::kable()%>%
kable_styling(bootstrap_options = "striped", font_size = 12)
#str(datosdivisa$created_at)
datos1$price_base_EUR[is.na(datos1$price_base_EUR)] <- 0
datos1$month <- month(datos1$created_at.x)
datos2 <- datos1 %>%
# group by year and summarizing sales
group_by(month) %>%
summarize(sales = sum(price_base_EUR)) %>%
ungroup()
datos2$sales <- format(round(as.numeric(datos2$sales), 1), nsmall=1, big.mark=",")
head(datos2)%>%
knitr::kable()%>%
kable_styling(bootstrap_options = "striped", font_size = 14)
datos$month <- month(datos$created_at)
datos$price_base[is.na(datos$price_base)] <- 0
datos0 <- datos %>%
# grouping by year and summarizing sales
group_by(month) %>%
summarize(sales = sum(price_base)) %>%
ungroup()
datos0 <- datos0[c(5,4,8,1,9,7,6,2,12,11,10,3),]
datos0$sales <- format(round(as.numeric(datos0$sales), 1), nsmall=1, big.mark=",")
head(datos0)%>%
knitr::kable()%>%
kable_styling(bootstrap_options = "striped", font_size = 14)
datos$month <- month(datos$created_at)
datos$price_base[is.na(datos$price_base)] <- 0
datos0 <- datos %>%
# grouping by year and summarizing sales
group_by(month) %>%
summarize(sales = sum(price_base)) %>%
ungroup()
datos0$sales <- format(round(as.numeric(datos0$sales), 1), nsmall=1, big.mark=",")
head(datos0)%>%
knitr::kable()%>%
kable_styling(bootstrap_options = "striped", font_size = 14)
datos2 <- datos1 %>%
select(c("ciudad.x","month","price_base_EUR"))
datos3 <- datos2 %>%
group_by(month,ciudad.x) %>%
summarize(sales = sum(price_base_EUR)) %>%
arrange() %>%
ungroup()
datos3$sales <- round(datos3$sales,2)
datos4 <- spread(datos3, key= ciudad.x, value= sales)
datos4[is.na(datos4)] <- 0
datos5 <- datos4 %>%
select(c("month","Buenos Aires","Guadalajara","Lima", "Santiago de Chile"))
datos6 <- datos4 %>%
select(c("month","Madrid","Barcelona"))
# Chart
datos6 %>%
gather("ciudad","sales",-month) %>%
glimpse() %>%
ggplot(aes(x=as.Date(month),y=sales, colour= ciudad)) +
geom_line() +
geom_point() +
geom_text(aes(label = round(sales, 0)),
vjust = "inward", hjust = "inward",
size=4) #+
#  # Formatting
#  theme_tq() +
#  scale_y_continuous(breaks=seq(100,1400,200)) +
#  scale_x_date(labels = date_format("%M"), breaks = date_breaks("month")) +
#  labs(
#    title = "Cohort New Listing Week 49 | Year 2020",
#    subtitle = "All Agents | All Listings",
#    x = "month",
#    y = "sales"
#  )
View(datos1)
datos2 <- datos1 %>%
select(c("ciudad.x","created_at","price_base_EUR"))
View(datos1)
datos2 <- datos1 %>%
select(c("ciudad.x","created_at.x","price_base_EUR"))
View(datos2)
datos2 <- datos1 %>%
select(c("ciudad.x","created_at.x","price_base_EUR")) %>%
mutate(week= week(created_at.x))
View(datos2)
datos3 <- datos2 %>%
group_by(week,ciudad.x) %>%
summarize(sales = sum(price_base_EUR)) %>%
arrange() %>%
ungroup()
View(datos3)
datos3$sales <- round(datos3$sales,2)
datos4 <- spread(datos3, key= ciudad.x, value= sales)
View(datos4)
datos4[is.na(datos4)] <- 0
madrid <- datos4 %>%
select(c("week","Madrid"))
View(madrid)
View(madrid)
library(ggplot2)
theme_set(theme_bw())
# Draw plot
ggplot(madrid, aes(x=week, y=Madrid)) +
geom_bar(stat="identity", width=.5, fill="tomato3") +
labs(title="Ordered Bar Chart",
subtitle="Make Vs Avg. Mileage",
caption="source: mpg") +
theme(axis.text.x = element_text(angle=65, vjust=0.6))
# Draw plot
ggplot(madrid, aes(x=week, y=Madrid)) +
geom_bar(stat="identity", width=.5, fill="tomato3") +
labs(title="Sales in Madrid",
subtitle="Week Number Vs Sales",
caption="source: private") +
theme(axis.text.x = element_text(angle=65, vjust=0.6))
# Draw plot
ggplot(madrid, aes(x=week, y=Madrid)) +
geom_bar(stat="identity", width=.5, fill="tomato3") +
labs(title="Sales in Madrid",
subtitle="Week Number Vs Sales",
caption="source: private") +
theme(axis.text.x = element_text(angle=65, vjust=0.6))require(scales)+
# Draw plot
ggplot(madrid, aes(x=week, y=Madrid)) +
geom_bar(stat="identity", width=.5, fill="tomato3") +
labs(title="Sales in Madrid",
subtitle="Week Number Vs Sales",
caption="source: private") +
theme(axis.text.x = element_text(angle=65, vjust=0.6))+
scale_x_continuous(labels = comma)
# Draw plot
ggplot(madrid, aes(x=week, y=Madrid)) +
geom_bar(stat="identity", width=.5, fill="tomato3") +
labs(title="Sales in Madrid",
subtitle="Week Number Vs Sales",
caption="source: private") +
theme(axis.text.x = element_text(angle=65, vjust=0.6))+
scale_y_continuous(labels = comma)
View(datos4)
View(datos3)
datos3 <- datos2 %>%
group_by(ciudad.x) %>%
summarize(sales = sum(price_base_EUR)) %>%
arrange() %>%
ungroup()
View(datos3)
datos3$sales <- round(datos3$sales,2)
datos4[is.na(datos4)] <- 0
View(datos4)
datos3[is.na(datos3)] <- 0
View(datos3)
View(datos3)
# Plot
ggplot(datos3, aes(x=ciudad.x, y=sales)) +
geom_point(col="tomato2", size=3) +   # Draw points
geom_segment(aes(x=ciudad,
xend=ciudad,
y=min(sales),
yend=max(sales)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Dot Plot",
subtitle="Make Vs Avg. Mileage",
caption="source: mpg") +
coord_flip()
# Plot
ggplot(datos3, aes(x=ciudad.x, y=sales)) +
geom_point(col="tomato2", size=3) +   # Draw points
geom_segment(aes(x=ciudad.x,
xend=ciudad.x,
y=min(sales),
yend=max(sales)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Dot Plot",
subtitle="Make Vs Avg. Mileage",
caption="source: mpg") +
coord_flip()
# Plot
ggplot(datos3, aes(x=ciudad.x, y=sales)) +
geom_point(col="tomato2", size=3) +   # Draw points
geom_segment(aes(x=ciudad.x,
xend=ciudad.x,
y=min(sales),
yend=max(sales)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Ciudades donde vende",
subtitle="Ciudad Vs Ventas",
caption="source: private") +
coord_flip()
# Plot
ggplot(datos3, aes(x=ciudad.x, y=sales)) +
geom_point(col="tomato2", size=3) +   # Draw points
geom_segment(aes(x=ciudad.x,
xend=ciudad.x,
y=min(sales),
yend=max(sales)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Ciudades donde vende",
subtitle="Ciudad Vs Ventas",
caption="source: private") +
scale_y_continuous(labels = comma) +
coord_flip()
#str(datosdivisa$created_at)
datos1$price_base_EUR[is.na(datos1$price_base_EUR)] <- 0
datos1$month <- month(datos1$created_at.x)
datos2 <- datos1 %>%
# group by year and summarizing sales
group_by(month) %>%
summarize(sales = sum(price_base_EUR)) %>%
ungroup()
datos2$sales <- format(round(as.numeric(datos2$sales), 1), nsmall=1, big.mark=",")
head(datos2)%>%
knitr::kable()%>%
kable_styling(bootstrap_options = "striped", font_size = 14)
#str(datosdivisa$created_at)
datos1$price_base_EUR[is.na(datos1$price_base_EUR)] <- 0
datos1$month <- month(datos1$created_at.x)
datos2 <- datos1 %>%
# group by year and summarizing sales
group_by(month) %>%
summarize(sales = sum(price_base_EUR)) %>%
ungroup()
datos2$sales <- format(round(as.numeric(datos2$sales), 1), nsmall=1, big.mark=",")
datos2%>%
knitr::kable()%>%
kable_styling(bootstrap_options = "striped", font_size = 14)
blogdown:::serve_site()
View(datos3)
View(datos2)
View(datos4)
datos4 <- datos1 %>%
select(c("ciudad.x","created_at.x","price_base_EUR")) %>%
mutate(week= week(created_at.x))
View(datos4)
datos5 <- datos4 %>%
group_by(week,ciudad.x) %>%
summarize(sales = sum(price_base_EUR)) %>%
arrange() %>%
ungroup()
View(datos5)
View(datos5)
datos5$sales <- round(datos5$sales,2)
View(datos5)
datos6 <- spread(datos5, key= ciudad.x, value= sales)
View(datos6)
datos6[is.na(datos6)] <- 0
View(datos6)
madrid <- datos6 %>%
select(c("week","Madrid"))
# Draw plot
ggplot(madrid, aes(x=week, y=Madrid)) +
geom_bar(stat="identity", width=.5, fill="tomato3") +
labs(title="Sales in Madrid",
subtitle="Week Number Vs Sales",
caption="source: private") +
theme(axis.text.x = element_text(angle=65, vjust=0.6))+
scale_y_continuous(labels = comma)
blogdown:::serve_site()
datos2 <- datos1 %>%
select(c("ciudad.x","created_at.x","price_base_EUR")) %>%
mutate(week= week(created_at.x))
datos3 <- datos2 %>%
group_by(ciudad.x) %>%
summarize(sales = sum(price_base_EUR)) %>%
arrange() %>%
ungroup()
datos3$sales <- round(datos3$sales,2)
datos3[is.na(datos3)] <- 0
theme_set(theme_classic())
# Plot
ggplot(datos3, aes(x=ciudad.x, y=sales)) +
geom_point(col="tomato2", size=3) +   # Draw points
geom_segment(aes(x=ciudad.x,
xend=ciudad.x,
y=min(sales),
yend=max(sales)),
linetype="dashed",
size=0.1) +   # Draw dashed lines
labs(title="Ciudades donde vende",
subtitle="Ciudad Vs Ventas",
caption="source: private") +
scale_y_continuous(labels = comma) +
coord_flip()
blogdown:::serve_site()
datos2 <- datos1 %>%
select(c("ciudad.x","created_at.x","price_base_EUR")) %>%
mutate(week= week(created_at.x))
datos3 <- datos2 %>%
group_by(ciudad.x) %>%
summarize(sales = sum(price_base_EUR)) %>%
arrange() %>%
ungroup()
datos3$sales <- round(datos3$sales,2)
datos3[is.na(datos3)] <- 0
theme_set(theme_bw())
# Plot
ggplot(datos3, aes(x=ciudad.x, y=sales)) +
geom_point(size=3) +
geom_segment(aes(x=ciudad.x,
xend=ciudad.x,
y=0,
yend=sales)) +
labs(title="Lollipop Chart",
subtitle="Make Vs Avg. Mileage",
caption="source: mpg") +
theme(axis.text.x = element_text(angle=65, vjust=0.6))
datos2 <- datos1 %>%
select(c("ciudad.x","created_at.x","price_base_EUR")) %>%
mutate(week= week(created_at.x))
datos3 <- datos2 %>%
group_by(ciudad.x) %>%
summarize(sales = sum(price_base_EUR)) %>%
arrange() %>%
ungroup()
datos3$sales <- round(datos3$sales,2)
datos3[is.na(datos3)] <- 0
theme_set(theme_bw())
# Plot
ciudades <- ggplot(datos3, aes(x=ciudad.x, y=sales)) +
geom_point(size=3) +
geom_segment(aes(x=ciudad.x,
xend=ciudad.x,
y=0,
yend=sales)) +
labs(title="Lollipop Chart",
subtitle="Make Vs Avg. Mileage",
caption="source: mpg") +
theme(axis.text.x = element_text(angle=65, vjust=0.6)) +
scale_y_continuous(labels = comma)
datos2 <- datos1 %>%
select(c("ciudad.x","created_at.x","price_base_EUR")) %>%
mutate(week= week(created_at.x))
datos3 <- datos2 %>%
group_by(ciudad.x) %>%
summarize(sales = sum(price_base_EUR)) %>%
arrange() %>%
ungroup()
datos3$sales <- round(datos3$sales,2)
datos3[is.na(datos3)] <- 0
theme_set(theme_bw())
# Plot
ggplot(datos3, aes(x=ciudad.x, y=sales)) +
geom_point(size=3) +
geom_segment(aes(x=ciudad.x,
xend=ciudad.x,
y=0,
yend=sales)) +
labs(title="Lollipop Chart",
subtitle="Make Vs Avg. Mileage",
caption="source: mpg") +
theme(axis.text.x = element_text(angle=65, vjust=0.6)) +
scale_y_continuous(labels = comma)
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::insert_image_addin()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
knitr::opts_chunk$set(collapse = TRUE)
Agents_SW_Joined_49 <- read_excel(path = "C:/Users/karlo/OneDrive/Escritorio/Deusto/Proyectos/Javier_Etxebeste/
Proyecto_1/data/Agents_SW_Joined_49.xlsx",
col_types = c("text", "text", "text", "text", "text",
"text","text", "text", "text"))
library(tidyverse)
library(lubridate)
library(tidyquant)
library(plotly)
library(scales)
library(readxl)
library(writexl)
library(knitr)
Agents_SW_Joined_49 <- read_excel(path = "C:/Users/karlo/OneDrive/Escritorio/Deusto/Proyectos/Javier_Etxebeste/
Proyecto_1/data/Agents_SW_Joined_49.xlsx",
col_types = c("text", "text", "text", "text", "text",
"text","text", "text", "text"))
Agents_SW_Joined_49 <- read_excel("C:/Users/karlo/OneDrive/Escritorio/Deusto/Proyectos/Javier_Etxebeste/
Proyecto_1/data/Agents_SW_Joined_49.xlsx",
col_types = c("text", "text", "text", "text", "text",
"text","text", "text", "text"))
library(tidyverse)
library(lubridate)
library(tidyquant)
library(plotly)
library(scales)
library(readxl)
library(writexl)
library(knitr)
Agents_SW_Joined_49 <- read_excel("C:/Users/karlo/OneDrive/Escritorio/Deusto/Proyectos/
Javier_Etxebeste/Proyecto_1/data/Agents_SW_Joined_49.xlsx",
col_types = c("text", "text", "text", "text", "text",
"text","text", "text", "text"))
Agents_SW_Joined_49 <- read_excel("C:/Users/karlo/OneDrive/Escritorio/Deusto/Proyectos/
Javier_Etxebeste/Proyecto_1/data/Agents_SW_Joined_49.xlsx",
col_types = c("text", "text", "text", "text", "text",
"text","text", "text", "text"))
Agents_SW_Joined_49 <- read_excel("C:/Users/karlo/OneDrive/Escritorio/Deusto/Proyectos/
Javier_Etxebeste/Proyecto_1/data/Agents_SW_Joined_49.xlsx",
col_types = c("text", "text", "text", "text", "text",
"text","text", "text", "text"))
Agents_SW_Joined_49 <- read_excel("C:/Users/karlo/OneDrive/Escritorio/Deusto/Proyectos/
Javier_Etxebeste/Proyecto_1/data/Agents_SW_Joined_49.xlsx",
col_types = c("text", "text", "text", "text", "text",
"text","text", "text", "text"))
Agents_SW_Joined_49 <- read_excel("C:/Users/karlo/OneDrive/Escritorio/Deusto/Proyectos/
Javier_Etxebeste/Proyecto_1/data/Agents_SW_Joined_49.xlsx"))
Agents_SW_Joined_49 <- read_excel("C:/Users/karlo/OneDrive/Escritorio/Deusto/Proyectos/
Javier_Etxebeste/Proyecto_1/data/Agents_SW_Joined_49.xlsx")
library(tidyverse)
library(lubridate)
library(tidyquant)
library(plotly)
library(scales)
library(readxl)
library(readr)
library(writexl)
library(knitr)
Agents_SW_Joined_49 <- read_excel(path = "C:/Users/karlo/OneDrive/Escritorio/Deusto/
Proyectos/Javier_Etxebeste/Proyecto_1/data/
Agents_SW_Joined_49.xlsx",
col_types = c("text", "text","text","text","text",
"text","text", "text", "text"))
